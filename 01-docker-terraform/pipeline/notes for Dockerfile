# Base image with Python installed
FROM python:3.13.10-slim

# Copy uv binary from official uv image into /bin/
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/

# Set working directory (all paths after this are relative to /app)
WORKDIR /app

# Add virtual environment to PATH so `python` finds installed packages
ENV PATH="/app/.venv/bin:$PATH"

# Copy dependency files (cached layer - only rebuilds if these change, ./ is the current directory in the container, which is /app)
COPY pyproject.toml uv.lock .python-version ./

# Install dependencies into /app/.venv/
RUN uv sync --locked

# Copy application code (changes often, so comes last)
COPY pipeline.py ./

# Default command to run
ENTRYPOINT ["uv", "run", "python", "pipeline.py"]

# /
# ├── bin/          ← system executables (uv goes here)
# │   └── uv
# ├── usr/
# │   └── local/
# │       └── bin/  ← more executables
# ├── app/          ← your project folder (WORKDIR)
# │   ├── .venv/
# │   │   └── bin/  ← python, pandas, etc.
# │   ├── pyproject.toml
# │   ├── uv.lock
# │   └── pipeline.py
# └── ...